<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro | TLOU</title>

    <link rel="stylesheet" href="style/index.css">
    <link rel="stylesheet" href="style/loginCadastro.css">
    <link rel="icon" href="../public/assets/img/logo.webp">
</head>

<body>
    <div class="bannerCadastroLogin">
        <video autoplay muted loop>
            <source src="./assets/gif/broken-window-the-last-of-us.1920x1080.mp4">
        </video>
        <div class="content">
            <div class="navCadastroLogin">
                <div class="logo">
                    <a href="index.html"><img src="./assets/img/logo.webp" alt="" height="50px"></a>
                </div>
            </div>
            <div class="tamanho_cadastro">
                <div class="card_cadastro">
                    <div class="alinhamento_titulo">
                        <div class="titulo">
                            <h1>Cadastro</h1>
                        </div>
                    </div>
                    <div class="formulario_cadastro">
                        <div class="campo_row">
                            <div class="campo_usuario">
                                <span>Usuário</span>
                                <input type="text" placeholder="Leticia" id="input_usuario" style="color: black">
                            </div>
                            <div class="campo_dt">
                                <span>Data de Nascimento:</span>
                                <input type="date" id="input_idade" style="color: black">
                            </div>
                        </div>
                        <div class="campo">
                            <span>E-mail:</span>
                            <input type="text" placeholder="Ex: email@email.com" id="input_email" style="color: black">
                        </div>
                        <div class="campo">
                            <span>Senha:</span>
                            <input type="password" placeholder="********" id="input_senha" style="color: black">
                        </div>
                        <div class="campo">
                            <span>Confirme sua senha:</span>
                            <input type="password" placeholder="********" id="input_confirma_senha"
                                style="color: black">
                        </div>
                        <div class="campo">
                            <span>Qual seu dispositivo?</span>
                            <select id="select_dispositivo" style="color: black">
                                <option value="ps5">Playstation 5</option>
                                <option value="ps4">Playstation 4</option>
                                <option value="ps3">Playstation 3</option>
                                <option value="pc">Notebook/Desktop</option>
                                <option value="outro">Outro</option>
                                <option value="#" disabled selected>Selecione...</option>
                            </select>
                        </div>
                    </div>
                    <div class="entrarCadastro">
                        <button onclick="cadastro()">Registrar</button>
                        <span>Já possui uma conta? Faça seu login <a href="login.html"
                                style="color: rgb(9, 255, 120)">aqui!</a></span>
                    </div>
                    <div id="div_mensagem"></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    function cadastro() {
        var mensagem = ``;

        var usuario = input_usuario.value;
        var tamanho_usuario = usuario.length;

        var idade = input_idade.value;

        var email = input_email.value;
        var tamanho_email = email.length;

        var senha = input_senha.value;
        var tamanho_senha = senha.length;

        var confirma_senha = input_confirma_senha.value;
        var tamanho_confirma = confirma_senha.length;

        var dispositivo = select_dispositivo.value;

        var termina_com = email.endsWith(".com");
        var arroba = email.includes('@');
        var caractereEspecial = senha.includes('!') || senha.includes('@') || senha.includes('#') || senha.includes('$');

        var temErro = false;

        if (tamanho_usuario <= 1) {
            mensagem += `<br> Usuário deve ter no mínimo 2 caracteres`;
        } else if (idade == "") {
            mensagem += `Data inválida`;
        } else if (tamanho_email <= 6 || termina_com == false || arroba == false) {
            mensagem += `<br> Email inválido`;
        } else if (senha != confirma_senha) {
            mensagem += `<br> As senhas estão diferentes`;
        } else if (senha == "" || caractereEspecial == false || tamanho_senha < 7) {
            mensagem += `<br> Senha deve ter no mínimo 1 caractere especial e no mínimo 8 caracteres <br>
            Caracteres especiais: "!", "@", "#", "$"`;
        } else if (dispositivo == "#") {
            mensagem += `<br> Insira um dispositivo`;
        } else {

            // Enviando o valor da nova input
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeServer: usuario,
                    idadeServer: idade,
                    emailServer: email,
                    senhaServer: senha,
                    dispositivoServer: dispositivo,
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        cardErro.style.display = "block";


                    } else {
                        alert("Houve um erro ao tentar realizar o cadastro!");
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });

            alert("Cadastro realizado com sucesso! Redirecionando para o Login...");

            window.location = "login.html";

            return false;
        }

        div_mensagem.innerHTML = mensagem;
    }
</script>